<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.IBoardDAO">

	<sql id="searchFrag">
     <trim prefix="WHERE" prefixOverrides="AND" suffixOverrides="OR"> 
			BO_SORT = 1 OR 1 = 1
			<if test="searchMap!=null and @org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.searchWord)">
				<trim prefix="AND (" suffix=")">
					<choose>
						<when test="searchMap.searchType eq 'title'">
							INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
						</when>
						<when test="searchMap.searchType eq 'writer'">
							INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
						</when>
						<when test="searchMap.searchType eq 'content'">
							INSTR(BO_CONTENT, #{searchMap.searchWord}) > 0
						</when>
						<when test="searchMap.searchType eq 'type'">
							BO_TYPE = #{searchMap.searchWord}
						</when>
						<otherwise>
							INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
							OR 
							INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
							OR
							INSTR(BO_CONTENT, #{searchMap.searchWord}) > 0
							OR
							BO_TYPE = #{searchMap.searchWord}
						</otherwise>
					</choose>
				</trim>
			</if>
			<trim prefix="AND (" suffix=")" prefixOverrides="AND">
				<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.minDate)">
					AND BO_DATE >= TO_DATE(#{searchMap.minDate}, 'YYYY-MM-DD') 
				</if>
				<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.maxDate)">
					<![CDATA[
					AND BO_DATE <= TO_DATE(#{searchMap.maxDate}, 'YYYY-MM-DD')
					]]> 
				</if>
			</trim>	
		</trim>
   </sql>


	<select id="selectBoardList" parameterType="PagingVO" resultType="BoardVO">
		SELECT B.*
		FROM (
			SELECT ROWNUM-3 RNUM, A.*
			FROM (
				SELECT
    			BO_SORT, BO_TYPE, BO_NO, 
    			BO_TITLE, BO_WRITER, 
    			BO_HIT, BO_REC, 
    			BO_REP,
    			TO_CHAR(BO_DATE, 'YYYY-MM-DD') BO_DATE
				FROM BOARDVIEW
				<include refid="searchFrag" />
				ORDER BY BO_SORT ASC, BO_DATE DESC
			)A	 
		)B	

		WHERE BO_SORT = 1 OR RNUM BETWEEN #{startRow} AND #{endRow}  
	
	
<!-- 		<![CDATA[ -->
<!-- 			WHERE BO_SORT = 1 OR RNUM >= #{startRow} AND RNUM <= #{endRow} -->
<!-- 		]]> -->
		
	</select>
	
	<select id="selectBoardCount" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
        FROM BOARDVIEW
        	<include refid="searchFrag" />
	</select>
	
	
	<select id="selectBoard" parameterType="BoardVO" resultType="BoardVO">
		  SELECT
            BO_SORT, BO_TYPE, BO_NO, 
    		BO_TITLE, BO_WRITER, BO_CONTENT,
    		BO_HIT, BO_REC, 
    		BO_REP,
    		TO_CHAR(BO_DATE, 'YYYY-MM-DD') BO_DATE
         FROM BOARDVIEW
        WHERE BO_NO = #{bo_no}
	</select>
 	</mapper>